---
title: 虚拟键盘遇到的坑
date: 2016-06-02 11:08:01
tags: [WebApp,虚拟键盘]
categories: work
---

前几天在做触屏版应用的时候，有碰到一个需求，将输入框固定在底部，当输入框聚焦时，弹出虚拟键盘，输入框跟随虚拟键盘上移，失去焦点时，输入框收回。waite、waite...WTF,这不是在原生应用中会遇到的场景嘛？
本以为用个固定定位就ok啦，没想到做出来的效果各种机型表现都不同买就是没有见到预期的效果。常见的就是：获取焦点弹出系统虚拟键盘时，挡住input。

<!-- more -->

网上有很多解决方式，比如[](https://mottie.github.io/Keyboard/)等，下面总结一个此次[项目中](http://www.uhoem.com/product/commonList.jhtml?id=16786e26-9d67-4b13-b7df-245d80725b1e)用到的方法。
![失去焦点和正常情况下](/images/foucs_ipt.jpg)  ![聚焦时](/images/blur_ipt.jpg)


## 代码
除评论框以外的元素都放在一个父元素，这里父元素是main。
```
//html
<form class="huifu">
    <textarea name="" placeholder="在此输入您的回复" class="falseReply"></textarea>
    <input type="submit" value="提交" class="btns"/>
    <input type="button" value="取消" class="btns cancel"/>
</form>
//css
.huifu{background-color:#4d4c4c;padding:0.4rem;width:100%;height:2rem;position:fixed;bottom:0;left:0;}
.huifu.up{position:static;margin:2rem auto;height:auto;}
.huifu textarea{width:86%;height:100%;line-height:1.2rem;border-radius:0;padding:0 0 0 0.2rem;background:#bfbfbf;display: inline-block;vertical-align:top;margin:0;color:#8c8c8c;font-size:0.48rem;}
.huifu input{font-size:0.48rem;width:11%;display: inline-block;float:right;color:#fff;line-height:1.2rem;text-align:center;border:none;background:none;height:100%;padding:0;}
.huifu.up textarea{width:100%;height:5rem;border:none;}
.huifu input.cancel{display: none;}
.huifu input.cancel.flex{display: block;background:none;border:1px solid #ee7800;color:#ee7800;}
.huifu input.flex{float:left;width:45%;height:2rem;background-color:#ee7800;color:#fff;margin-top:2rem;}
.huifu input.flex:nth-last-child(1){margin-left:10%;}
.huifu #consultationtype{display: none;background:#bfbfbf;width:100%;padding-left:0.4rem;padding-top:0.4rem;}
.huifu #consultationtype li{float:left;margin-right:0.4rem;margin-bottom:0.4rem;padding:0 0.13rem;border:1px solid #666;font-size:0.44rem;line-height:0.8rem;color:#666;}
.huifu #consultationtype li.active{color:#fff;background-color:#666;}
//js
$(function(){
    //虚拟键盘
    var $all=$('.huifu');
    var $input = $('.falseReply');
    var originHieght; // 页面呼出键盘前的位置

    $input.on('focus', function () {
        // 纪录页面位置
        originHieght = $(window).scrollTop();
        $('#item3').hide();
        // 设置延时回到顶部，解决ios错位问题
        window.setTimeout(function () {
            $all.addClass('up');
            $('.btns').addClass('flex');
            $(window).scrollTop(0);
        }, 100);
    });

    $input.on('blur', function () {
        $all.removeClass('up');
        $('.btns').removeClass('flex');
        $('#item3').show();
        // 回到原始位置
        $(window).scrollTop(originHieght);
    });

    $('.cancel').on('click', function () {
        $input.blur();
    });
});
```

## 思想
聚焦时，隐藏除评论框以外的元素；将form从固定定位设置为静态定位，修改样式等